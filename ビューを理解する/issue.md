# ビューを使いこなす

## 課題（質問）

### ビューの仕組み

- SQL の「ビュー」とは、データベース内のテーブルから作られた仮想のテーブルのこと
- 仮想のテーブルを作ることで、データベース内のテーブルを簡単に扱いやすくすることができる
- 例えば、データベース内のテーブルから、特定のカラムだけを選択したい場合、ビューを作成することができる

### ビューの用途とメリット

- コードの再利用：「ビュー」を使用することで、同じ SQL クエリを繰り返し使用する必要がなくなる。「ビュー」を作成すると、以降は「ビュー」を使用するだけで、必要なデータを取得することができる。
- データの抽象化：「ビュー」を使用することで、データベース内のテーブルから特定のカラムだけを選択した仮想のテーブルを作成することができる。この仮想のテーブルを使用することで、データベース内のテーブルをより簡単に扱うことができる。
- データのセキュリティ：「ビュー」を使用することで、特定のユーザーに対してデータベース内のテーブルから特定のカラムだけを表示することができる。このように、「ビュー」を使用することで、データベース内のセキュリティを簡単に管理することができる。
- データの変更の保証：「ビュー」は仮想のテーブルであり、実際のテーブルに対する変更は「ビュー」には影響しない。このように、「ビュー」を使用することで、データベース内のテーブルの変更に対する影響を最小限に抑えることができる。

### Materialized View と通常のビューの違い

- Materialized View とは、通常のビューとは異なり、実際にデータを保存する仮想のテーブルのこと。
- 通常のビューは、実際のテーブルから作られた仮想のテーブルであり、データは実際のテーブルから取得される。このため、ビューを使用するたびに、実際のテーブルからデータを取得する必要がある。
- Materialized View は、通常のビューとは異なり、実際にデータを保存する仮想のテーブル。Materialized View は実際のテーブルから作られますが、作成された後は実際のテーブルからのデータの取得は必要ない。このため、Materialized View を使用すると、データベースのパフォーマンスが向上することがある。
- Materialized View は、大量のデータを頻繁に取得するアプリケーションやレポート生成など、パフォーマンスが重要な場合に適している。しかし、Materialized View は実際のテーブルからのデータの更新が頻繁に行われる場合には、データの更新が遅れる場合があることも要注意。

## 課題 2（実装）

ビュー作成前の実行時間: 28s
ビュー作成後の実行時間: 12s

```
CREATE VIEW employee_salary_view AS
SELECT emp.last_name, SUM(sal.salary) sum
FROM employees.employees emp
INNER JOIN employees.salaries sal
ON emp.emp_no = sal.emp_no
GROUP BY emp.last_name
HAVING sum =
(
    SELECT MAX(tmp.tmp_sum)
    FROM
    (
        SELECT SUM(sal2.salary) tmp_sum
        FROM employees.employees emp2
        INNER JOIN employees.salaries sal2
        ON emp2.emp_no = sal2.emp_no
        GROUP BY emp2.last_name
    ) tmp
);
```
