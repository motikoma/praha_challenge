# データベースにおけるNULLの扱い

## 課題1
* SELECT NULL = 0;
    * 結果：NULL
* NULL = NULL (以下、SELECT部分を省略)
    * 結果：NULL
* NULL <> NULL
    * 結果：NULL
* NULL AND TRUE
    * 結果：NULL
* NULL AND FALSE
    * 結果：NULL
* NULL OR TRUE
    * 結果：1
* NULL IS NULL
    * 結果：1
* NULL IS NOT NULL
    * 結果：0

## 課題2

### 見直したテーブル設計
https://www.figma.com/file/QfzzQtjFU7rzy6KAi4VwhV/Praha_Challenge_DB%E3%83%A2%E3%83%87%E3%83%AA%E3%83%B3%E3%82%B0?node-id=539%3A1949 

### NULLがデータベースに存在することは本当に悪いことか？
* リレーショナルモデル
    * リレーションにNULLが含まれているとリレーショナルモデルは成立しない
    * 集合の一種であるリレーションにはNULLという概念が存在しない
    * NULLは値が不明なことを示すマーカーなので、演算結果が一意に決まらない
        * 例：地域=アジアという条件で制限を実行すると結果にNULLを含めるべきかわからない
            * NULLはアジアかもしれないし、そうでないかもしれない
* リレーショナルモデルをもとにしたデータベース
    * 基本的にはNULLを排除することを考えると良い設計になる
        * NULLがあると不便な仕様
            * NULLの場合は値と比較できないので、IS NULLなどで判定する必要がある
                * 特に式の意味が「否定」になる場合に見落としがちで不具合を生み出す要因になる
                * 例：select * from user where age <> 20 age IS NULL
            * オプティマイザへの悪影響
                * NULLに対するインデックスは効くが、クエリの実行コスト見積に混乱を引き起こす
                * 参考：理論から学ぶデータベース実践入門 第7章 NULLとの戦い 
    * NULLがあると便利なユースケース
        * 既存のテーブルにカラムを追加する場合にNULLにしておくことができる
            * NULLがない場合はデフォルト値を必ず入れておく必要があるが適切なデフォルト値（例：9999）が難しい
            * そもそもテーブルを分割すれば良いというのが前提ではあるが、毎回テーブルを分割するわけにはいかないのでは？
                * 元のテーブルから概念ごとにカラムを抜粋し、新しいテーブルにまとめ直すなどのリファクタリングで対応できそう
        * 記録の発生順番にとらわれずにレコードを追加することができる
            * そもそも中間テーブルを用意することでNULLを使わずに解決できる

## 課題3
* 既存のテーブルに対してレコードが存在する場合、NULLを前提にSQLが実装されているはず。その場合、勝手にデフォルト値を設定すると不具合が発生する
* 新規のテーブルの場合、NOT NULL制約を付与すること自体は悪くない。ただ、デフォルト値を設定するべきかどうかは状況による。設計の際にチーム内でレビューが必要。

## 課題4
* インデックスにおいてNULLはどのように扱われるか調べてみてください