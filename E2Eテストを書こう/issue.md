# E2Eテストを書こう

## 課題1
### praha_challenge_e2e参照

### カスタム属性を追加する必要性
* タグ、クラス、またはIDによって要素を操作することは、非常に不安定であり、変更の可能性が高い
    * 要素を入れ替えたり、CSSをリファクタリングしてIDを更新したり、要素のスタイルに影響するクラスを追加または削除したりすることがある
* カスタムデータ属性を使用すれば下記のメリットが得られる
    * テストにのみ使用されるターゲットセレクタを得ることができる
    * 要素がE2Eテストで使用されることを明示できる

### Container/PresentationalパターンはロジックとUIを分けて実装することで関心の分離を図るフロントエンドのデザインパターン
* Presentational Component
    * UIの描画に関心を持つコンポーネント
    * Propsで受け取ったデータをどのように表示するかのみを役割として持つ
    * 該当コンポーネント内に閉じたUIに関する状態であれば持つこともある
* Container Component
    * ロジックに関心を持つコンポーネント
    * APIや状態管理ライブラリから取得したデータをそれぞれのPresentational Componentに渡す
    * Container Componentで使用するPresentational Component以外で独自で要素をレンダリングすることはなくスタイルを持つこともない

hooksによるContainer/Presentationalパターンの置き換えについて
* コンポーネントの再利用性やテストの容易性を考えるとhooksとContainer/Presentationalパターンを組み合わせた方が良い
    * hooksにロジックを抽出したとしてもhooksを呼び出しているコンポーネントがhooksに依存する
* hooksを呼び出すコンポーネントをContainerコンポーネントとして扱う

### 参考
* [Container/Presentationalパターン再入門](https://zenn.dev/kazu777/articles/9460c75b7cd8d1)

## 課題2
### E2Eテストのメリットとデメリット
* メリット
    * 自動化に伴い手動テストコストを減らすことができる
* デメリット
    * フロントエンド修正に伴う保守コストが大きい
        * デメリットを抑えるためにテストピラミッドの考え方に則り、E2Eテスト対象を重要な導線に絞る
        * https://speakerdeck.com/twada/history-of-tdd-xpjug-2018-keynote?slide=60

### テスト手法（単体、統合、E2Eなど）を選択する際の基準
前提としてテストピラミッドの思想に従ってテストを実装する
* https://speakerdeck.com/twada/history-of-tdd-xpjug-2018-keynote?slide=60

新規開発
* 前提: プロダクトコードがない状態
* スタイル：機能を作りながらテストを実装していく
* フロントエンド
    * 単体テスト
        * ロジックを切り出したhooksに対するテスト
        * コンポーネントのStorybookを作成し、表示と機能の確認を目視で行う
        * ビジュアルリグレッションテストで予期せぬ影響を防ぐ
* バックエンド:
    * 単体テスト
        * 各レイヤーごとのテストを実装
    * 統合テスト
        * 一部の重要なAPIに対してテストを実装
* E2Eテスト
    * mablなどのE2Eテスト作成ツールを使用し、重要な導線に対してのみ実施する

既存開発
* 前提: プロダクトコードがある状態
* スタイル：まず統合テストを作成してからプロダクトコードを修正する。その後テストピラミッドに近づけていく。
* フロントエンド
    * 新規開発と同様
* バックエンド
    * 単体テスト
        * 自信がない複雑な箇所にのみ実装する
        * アーキテクチャ変更と共に増やしていく
    * 統合テスト
        * 一通りのAPIに対し実装することで意図せぬ不具合を予防してリファクタリング可能にする
        * アーキテクチャ変更と共に減らしていく
* E2Eテスト
    * 新規開発と同様

### E2Eテストにおける要素（ボタンや文言など）を選択時の注意
* 要素のcssのclassを識別子に使う場合、class名が変更されるとテストが失敗する
* 要素のcssのidを識別子に使うと、id名が変更されるとテストが失敗する
* 要素の文言を識別子に使うと、文言が変更されるとテストが失敗する

### E2Eテストにおける壊れにくい要素選択
* カスタムデータ属性を使用することでcssやjsの修正の影響を受けにくくすることができる
* ただし、DOMの構造を変更するときはカスタムデータ属性を付け直す必要がある

## 課題3（課題）
残念ながらCypress Studioは今後提供されなくなるようです...
https://www.cypress.io/blog/2022/05/18/update-on-cypress-studio/ 

## 課題4（クイズ）
E2Eテストの作成を自動化してくれる便利なツールが最近増えつつあります。
下記のツールのうちどれか1つを選んで、CypressなどのE2Eテストツールと比較したメリデメを考えてみてください。
* MagicPod
* mabl
* Autify

## 参考
* [質とスピード](https://speakerdeck.com/twada/quality-and-speed-2022-spring-edition)
* [テスト駆動開発の過去・現在・未来 / History of TDD - XPJUG 2018 Keynote](https://speakerdeck.com/twada/history-of-tdd-xpjug-2018-keynote?slide=60)
* 書籍：ソフトウェア品質を高める開発者テスト 改訂版 アジャイル時代の実践的・効率的でスムーズなテストのやり方
* 

